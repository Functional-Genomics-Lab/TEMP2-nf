#!/bin/bash

if [ $# -lt 1 ];then
	echo -e "$0 in.final.bed"
	exit 1
fi

gawk 'BEGIN{FS=OFS="\t"}
{
	st=$6==$8?"-":"+";
	if($6=="+-"){tp="1p1"}else if($15~/\|/){tp="2p"}else{tp="singleton"};
	if($3<$2 && $2-$3<50){tsd=$1":"$3"-"$2}else{tsd="unknown"};
	if(tp=="1p1"){
		if(($16>0 && $17>0) || $3<=$2){
			s=$2<$3?$2:$3;e=$2>$3?$2:$3;p5=$2;p3=$3
		}else if($16>0 && $17==0){
			s=$2;e=$2+1;p5=$2;p3=$2+1
		}else if($16==0 && $17>0){
			s=$3-1;e=$3;p5=$3-1;p3=$3
		}else{
			s=$2;e=$3;p5=int(($2+$3)/2);p3=int(($2+$3)/2)+1
		}
	}else{
		if($16>0){
			s=$2;e=$2+1;p5=$2;p3=$2+1
		}else if($17>0){
			s=$3-1;e=$3;p5=$3-1;p3=$3
		}else{
			s=$2;e=$3;p5=int(($2+$3)/2);p3=int(($2+$3)/2)+1
		}
	}
	print $1,s,e,$7,$4,st,tp,$9,$10,"+"$11,"-"$12,tsd,$15,p5,p3,$16,$17
}
' $1
